<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" contents="It is fun, it is fast and is easy. Search with google and get the results as 3D pegmen">

    <title>google search pegmen (v2.0)</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootbox-dialoges.css">

    <script src="/socketcluster.js"></script>
    <script src="/sc-codec-min-bin.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <script src="/js/bootbox.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <script>

        var debugMode = true;

    </script>

</head>

<body style="overflow:hidden;">

<section class="mbr-section" id="body-section" style="width:100vw;height:100vh;overflow:hidden;">

    <div class="input-group" style="margin-top:0px;">
        <input type="text" id="google-search-field" class="form-control" placeholder="Type something here and ask Google:" aria-describedby="google-search" value="">
        <div id="google-search-button" role="button" class="input-group-addon btn btn-primary">Ask Google</div>
    </div>

    <div id="viewer-container" style="position:absolute;top:35px;left:0;right:0;bottom:0;margin:0;">
        <iframe id="viewer" src="//:0" style="width:100%;height:100%;overflow:hidden;border:none;"></iframe>
    </div>

</section>

<script>

//  Socketcluster.

    var socket = socketCluster.create({
        hostname: "anywhere3d.com",
        codecEngine: scCodecMinBin,
    });

    socket.on("connect", function(status){
        debugMode && console.log({"status": status});
    });

    socket.on("error", function (err) {
        console.error( err.stack );
    });

    socket.on("authStateChange", function( state ){
        debugMode && console.log({"authStateChange": state});
    });

    socket.on("subscribe", function( name, object ){
        debugMode && console.log(`subscribed successfully to "${name}" channel:`, object);
    });


    var results;
    var contentDocument;
    var viewer = $("iframe#viewer").get(0);
    var searchField = $("#google-search-field").get(0);

    $("#google-search-button").on("click", function(){

        if (!searchField.value) throw "Type something and try again.";

        socket.emit("ask google", {query:searchField.value}, function(err, data){
            new Promise(function(resolve, reject){
                resolve( viewer.srcdoc = data );
            }).then(function(){
                return $(viewer.contentDocument).find("#main")
                .find(".ZINbbc.xpd.O9g5cc.uUPGi").toArray();
            }).then(function(results){
                results.forEach(function(result){
                    debugMode && console.log( $(result).text() );
                });
            });
        });

    });


</script>

</body>
</html>


<script>

/*
    //  sw.js
        var serviceWorker = navigator.serviceWorker;
        if ( serviceWorker ) {
            serviceWorkerRegistration( serviceWorker, {
                opt: {scope: "/gws/"},
                url: "/gws/gws-sw.js",
            });
        }

        function serviceWorkerRegistration( serviceWorker, options ){
            if (!serviceWorker) {
                console.warn("Oh no! "
                    + "Your browser doesn't support "
                    + "a feature needed to run this app "
                    + "(navigator.serviceWorker).\n" 
                    + "Try using a different browser.");
                return;
            }
            serviceWorker.register(options.url, options.opt).then(function (reg) {
                reg.addEventListener("statechange", function(){
                    debugMode && console.log({"reg active state": reg.active.state});
                });
                reg.addEventListener("updatefound", function(){
                    var newSWController = reg.installing;
                    debugMode && console.log("new service worker update found:");
                    newSWController.addEventListener("statechange", function(){
                        debugMode && console.log({"new sw controller state": this.state});
                        if ( this.state === "activated") { 
                            //  do something
                        }
                    });
                });
            //  Refresh to activate the worker.
            //  if (!reg.active) {
            //      location.reload(); return;
            //  } 
            }).catch(function(err) { 
                console.error(err);
            });
        }
*/
</script>
